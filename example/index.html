<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue</title>
</head>
<body>
    <div id = "app"></div>
</body>
</html>
<script src="../dist/vue.js"></script>
<!-- <script>
    const {
        createApp,
        reactive,
        computed,
        watchEffect
    } = Vue;
    const MyComponent = {
        template: `
            <button @click="click">
            {{ state.message }}
            </button>
        `,
        setup() {
            const state = reactive({
                message:'Hello Vue 3!!'
            })
            watchEffect(() => {
                console.log('state change ', state.message)
            })
            function click() {
                state.message = state.message.split('').reverse().join('')
            }
            return {
                state,
                click
            }
        }
    }
    createApp(MyComponent).mount('#app')
</script> -->

<script>
    // 原理版
    let activeEffect;
    class Dep{
        constructor(value){
            this.subscribers = new Set()
            this._value = value
        }
        get value(){
            this.depend();
            return this._value
        }
        set value(newValue){
            this._value = newValue;
            this.notify()
        }
        depend(){
            activeEffect && this.subscribers.add(activeEffect)
        }
        notify(){
            this.subscribers.forEach(effect => {
                effect()
            })
        }
    }

    function watchEffect(effect){
        activeEffect = effect;
        effect();
        activeEffect = null;
    }

    const dep = new Dep('frist');
    const msg = new Dep('frist111');

    watchEffect(() => {
        console.log('effect中有值变动：'+dep.value+ '-------' +msg.value)
    })

    dep.value = 'change'
    msg.value = '2222'
</script>